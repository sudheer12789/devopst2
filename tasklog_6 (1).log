2020-03-12T07:07:52.6037588Z ##[section]Starting: Azure CLI to deploy required Azure resources
2020-03-12T07:07:53.1738889Z ==============================================================================
2020-03-12T07:07:53.1739313Z Task         : Azure CLI
2020-03-12T07:07:53.1739827Z Description  : Run Azure CLI commands against an Azure subscription in a Shell script when running on Linux agent or Batch script when running on Windows agent.
2020-03-12T07:07:53.1740304Z Version      : 1.163.0
2020-03-12T07:07:53.1740583Z Author       : Microsoft Corporation
2020-03-12T07:07:53.1740972Z Help         : https://docs.microsoft.com/azure/devops/pipelines/tasks/deploy/azure-cli
2020-03-12T07:07:53.1741436Z ==============================================================================
2020-03-12T07:07:54.1620436Z [command]C:\windows\system32\cmd.exe /D /S /C ""C:\Program Files (x86)\Microsoft SDKs\Azure\CLI2\wbin\az.cmd" --version"
2020-03-12T07:08:12.5940513Z azure-cli                          2.1.0 *
2020-03-12T07:08:12.5941920Z 
2020-03-12T07:08:12.5943037Z command-modules-nspkg              2.0.3
2020-03-12T07:08:12.5944089Z core                               2.1.0 *
2020-03-12T07:08:12.5960070Z nspkg                              3.0.4
2020-03-12T07:08:12.5965725Z telemetry                          1.0.4
2020-03-12T07:08:12.5970963Z 
2020-03-12T07:08:12.5976018Z Extensions:
2020-03-12T07:08:12.5981658Z azure-devops                      0.17.0
2020-03-12T07:08:12.5998286Z 
2020-03-12T07:08:12.5999294Z Python location 'C:\Program Files (x86)\Microsoft SDKs\Azure\CLI2\python.exe'
2020-03-12T07:08:12.6000298Z Extensions directory 'C:\Program Files\Common Files\AzureCliExtensionDirectory'
2020-03-12T07:08:12.6030365Z 
2020-03-12T07:08:12.6036208Z Python (Windows) 3.6.6 (v3.6.6:4cf1f54eb7, Jun 27 2018, 02:47:15) [MSC v.1900 32 bit (Intel)]
2020-03-12T07:08:12.6043387Z WARNING: You have 2 updates available. Consider updating your CLI installation. Instructions can be found at https://docs.microsoft.com/en-us/cli/azure/install-azure-cli
2020-03-12T07:08:12.6044373Z 
2020-03-12T07:08:12.6079835Z Legal docs and information: aka.ms/AzureCliLegal
2020-03-12T07:08:12.6080936Z 
2020-03-12T07:08:12.6083136Z 
2020-03-12T07:08:12.6114178Z 
2020-03-12T07:08:12.6127814Z 
2020-03-12T07:08:12.6131431Z Please let us know how we are doing: https://aka.ms/clihats
2020-03-12T07:08:12.6148367Z Setting AZURE_CONFIG_DIR env variable to: D:\a\_temp\.azclitask
2020-03-12T07:08:12.6150303Z Setting active cloud to: AzureCloud
2020-03-12T07:08:12.6168352Z [command]C:\windows\system32\cmd.exe /D /S /C ""C:\Program Files (x86)\Microsoft SDKs\Azure\CLI2\wbin\az.cmd" cloud set -n AzureCloud"
2020-03-12T07:08:18.7726847Z [command]C:\windows\system32\cmd.exe /D /S /C ""C:\Program Files (x86)\Microsoft SDKs\Azure\CLI2\wbin\az.cmd" login --service-principal -u *** -p *** --tenant ***"
2020-03-12T07:08:22.5410933Z [
2020-03-12T07:08:22.5421684Z   {
2020-03-12T07:08:22.5442253Z     "cloudName": "AzureCloud",
2020-03-12T07:08:22.5453595Z     "homeTenantId": "***",
2020-03-12T07:08:22.5454308Z     "id": "549656a0-f905-4228-b44f-144fd54b31a8",
2020-03-12T07:08:22.5457979Z     "isDefault": true,
2020-03-12T07:08:22.5458539Z     "managedByTenants": [],
2020-03-12T07:08:22.5458960Z     "name": "Free Trial",
2020-03-12T07:08:22.5459397Z     "state": "Enabled",
2020-03-12T07:08:22.5460122Z     "tenantId": "***",
2020-03-12T07:08:22.5462801Z     "user": {
2020-03-12T07:08:22.5463546Z       "name": "***",
2020-03-12T07:08:22.5464006Z       "type": "servicePrincipal"
2020-03-12T07:08:22.5464379Z     }
2020-03-12T07:08:22.5464653Z   }
2020-03-12T07:08:22.5464965Z ]
2020-03-12T07:08:22.5728374Z [command]C:\windows\system32\cmd.exe /D /S /C ""C:\Program Files (x86)\Microsoft SDKs\Azure\CLI2\wbin\az.cmd" account set --subscription 549656a0-f905-4228-b44f-144fd54b31a8"
2020-03-12T07:08:23.8860863Z [command]C:\windows\system32\cmd.exe /D /S /C "D:\a\_temp\azureclitaskscript1583996873419.bat"
2020-03-12T07:08:23.8996498Z 
2020-03-12T07:08:23.8997393Z D:\a\r1\a># this will create Azure resource group 
2020-03-12T07:08:23.9052986Z '#' is not recognized as an internal or external command,
2020-03-12T07:08:23.9053739Z operable program or batch file.
2020-03-12T07:08:23.9054355Z 
2020-03-12T07:08:23.9054752Z D:\a\r1\a>call az group create --location westus --name terraformrg 
2020-03-12T07:08:26.0305895Z ERROR: The client 'f88888fc-1f9b-4458-b4b4-262ddf735e24' with object id 'f88888fc-1f9b-4458-b4b4-262ddf735e24' does not have authorization to perform action 'Microsoft.Resources/subscriptions/resourcegroups/write' over scope '***rg' or the scope is invalid. If access was recently granted, please refresh your credentials.
2020-03-12T07:08:26.1333281Z 
2020-03-12T07:08:26.1334449Z D:\a\r1\a>call az storage account create --name terraformstorage43a5376d --resource-group terraformrg --location westus --sku Standard_LRS 
2020-03-12T07:08:28.9461102Z ERROR: The client 'f88888fc-1f9b-4458-b4b4-262ddf735e24' with object id 'f88888fc-1f9b-4458-b4b4-262ddf735e24' does not have authorization to perform action 'Microsoft.Storage/storageAccounts/write' over scope '/subscriptions/549656a0-f905-4228-b44f-144fd54b31a8/resourceGroups/terraformrg/providers/Microsoft.Storage/storageAccounts/terraformstorage43a5376d' or the scope is invalid. If access was recently granted, please refresh your credentials.
2020-03-12T07:08:29.0370830Z 
2020-03-12T07:08:29.0371899Z D:\a\r1\a>call az storage container create --name terraform --account-name terraformstorage43a5376d 
2020-03-12T07:08:30.2227587Z WARNING: No connection string, account key or sas token found, we will query account keys for your storage account. Please try to use --auth-mode login or provide one of the following parameters: connection string, account key or sas token for your storage account.
2020-03-12T07:08:31.7617877Z usage: az storage container create [-h] [--verbose] [--debug]
2020-03-12T07:08:31.7619039Z                                    [--output {json,jsonc,table,tsv,yaml,yamlc,none}]
2020-03-12T07:08:31.7619543Z                                    [--query JMESPATH]
2020-03-12T07:08:31.7620139Z                                    [--account-name ACCOUNT_NAME]
2020-03-12T07:08:31.7620552Z                                    [--account-key ACCOUNT_KEY]
2020-03-12T07:08:31.7621014Z                                    [--connection-string CONNECTION_STRING]
2020-03-12T07:08:31.7621474Z                                    [--sas-token SAS_TOKEN]
2020-03-12T07:08:31.7621892Z                                    [--subscription _SUBSCRIPTION] --name
2020-03-12T07:08:31.7622318Z                                    CONTAINER_NAME
2020-03-12T07:08:31.7622733Z                                    [--metadata METADATA [METADATA ...]]
2020-03-12T07:08:31.7623192Z                                    [--public-access {off,blob,container}]
2020-03-12T07:08:31.7623639Z                                    [--fail-on-exist] [--timeout TIMEOUT]
2020-03-12T07:08:31.7634004Z                                    [--auth-mode {login,key}]
2020-03-12T07:08:31.7634634Z az storage container create: error: Storage account 'terraformstorage43a5376d' not found.
2020-03-12T07:08:31.8534602Z 
2020-03-12T07:08:31.8535532Z D:\a\r1\a>call az storage account keys list -g terraformrg -n terraformstorage43a5376d 
2020-03-12T07:08:33.4042105Z ERROR: The client 'f88888fc-1f9b-4458-b4b4-262ddf735e24' with object id 'f88888fc-1f9b-4458-b4b4-262ddf735e24' does not have authorization to perform action 'Microsoft.Storage/storageAccounts/listKeys/action' over scope '/subscriptions/549656a0-f905-4228-b44f-144fd54b31a8/resourceGroups/terraformrg/providers/Microsoft.Storage/storageAccounts/terraformstorage43a5376d' or the scope is invalid. If access was recently granted, please refresh your credentials.
2020-03-12T07:08:33.5167414Z ##[error]Script failed with error: Error: The process 'D:\a\_temp\azureclitaskscript1583996873419.bat' failed with exit code 1
2020-03-12T07:08:33.5304617Z [command]C:\windows\system32\cmd.exe /D /S /C ""C:\Program Files (x86)\Microsoft SDKs\Azure\CLI2\wbin\az.cmd" account clear"
2020-03-12T07:08:34.8058265Z ##[section]Finishing: Azure CLI to deploy required Azure resources
